# РАСПРЕДЕЛЕННАЯ СИСТЕМА ОБМЕНА СООБЩЕНИЯМИ
> # Реализована система обмена сообщениями между клиентами с помощью брокера сообщений.

Основные типы запросов:
- запрос регистрации клиента (получение уникального идентификатора от сервера);
- отправка сообщения;
- запрос сообщения;
- завершение сессии (удаление клиента из списка).

Сообщение состоит из заголовка и данных. Заголовок включает поля:
- отправитель;
- получатель (идентификатор другого клиента, идентификатор сервера, псевдоидентификатор "все клиенты" для широковещательных сообщений);
- тип сообщения;
- размер сообщения.

С каждым клиентом сопоставляется объект класса (Session), включающий следующие поля и функции:
- идентификатор клиента;
- очередь сообщений, адресованных клиенту;
- критическая секция для защиты очереди от одновременного использования;
- событие с автоматическим сбросом;
- клиентский сокет;
- время последнего взаимодействия с клиентом;
- функцию добавления сообщения в очередь;
- функцию проверки наличия сообщений в очереди;
- функцию получения (и последующего удаления) сообщения из очереди;
- функцию, определяющую превышение клиентом допустимого периода неактивности.

Работа с очередью защищается критической секцией.

Сервер хранит контейнер  объектов Session, соответствующих активным клиентам.

Взаимодействие клиентов с сервером включает три основные стадии:
1. Первичная регистрация:
- клиент отправляет на сервер запрос на регистрацию;
- сервер формирует новый идентификатор клиента (на основе глобального счетчика), создает объект класса Session, добавляет его в список активных клиентов, отвечает клиенту, передав в ответе его идентификатор.

2. Основная работа:
- клиент формирует сообщение, отправляя его на сервер;
- сервер, получив сообщение, проверяет корректность его отправителя и адресата (присутствуют ли они в контейнере активных клиентов), далее добавляет его в очередь клиента-адресата;
- любое взаимодействие с клиентом приводит к корректировке поля, в котором хранится время последнего взаимодействия.

3. Завершение работы:
- по явному запросу клиента соответствующий ему объект удаляется из списка активных клиентов;
- по таймауту: сервер содержит отдельный поток, периодически проходящий по списку клиентов и удаляющий тех, интервал взаимодействие с которыми превысил таймаут.

# КЛИЕНТСКИЕ ПРИЛОЖЕНИЯ
> **С++**

> **С#** 

> **Python** 

> **CGI**

> **REST** 

# ОБЩАЯ СХЕМА
![ЭКРАН 1](https://i.ibb.co/3M5tx9w/IntSys.png)






